<div class="recognition-container">
  <div class="recognition-header">
    <h2>История поиска по фотографиям</h2>
  </div>

  <table class="data-table">
    <thead>
      <tr>
        <th>Выбрать</th>
        <th>№</th>
        <th>Дата загрузки</th>
        <th>Фото</th>
        <th>Адрес</th>
        <th>Координаты</th>
        <th>Статус</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let row of data">
        <td><input type="checkbox" [(ngModel)]="row.selected" /></td>
        <td>{{ row.id }}</td>
        <td>{{ row.date }}</td>
        <td>
          <img *ngIf="row.photo_url" [src]="row.photo_url" alt="Фото" width="60" />
        </td>
        <td>{{ row.address || '—' }}</td>
        <td>
          <a [routerLink]="['/map']" [queryParams]="{ lat: row.lat, lon: row.lon }">
            {{ row.lat }}{{ row.lat && row.lon ? ', ' : '' }}{{ row.lon }}
          </a>
        </td>
        <td>{{ row.status }}</td>
      </tr>
    </tbody>
  </table>

  <div class="table-footer">
    <div class="pagination">
      <button
        class="page-btn"
        [disabled]="currentPage === 1"
        (click)="loadPage(currentPage - 1)">
        «
      </button>

      <button
        *ngFor="let page of [].constructor(lastPage); let i = index"
        class="page-btn"
        [class.active]="currentPage === i + 1"
        (click)="loadPage(i + 1)">
        {{ i + 1 }}
      </button>

      <button
        class="page-btn"
        [disabled]="currentPage === lastPage"
        (click)="loadPage(currentPage + 1)">
        »
      </button>
    </div>

    <a class="map-link" [routerLink]="['/map']" [queryParams]="firstSelectedQuery()">
      Отобразить на карте
    </a>
  </div>
</div>

<app-upload-modal
  *ngIf="showModal"
  (close)="showModal = false"
  (uploaded)="handleFile($event)">
</app-upload-modal>
